<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Modelos Lineares Generalizados - Binomial</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Jose Storopoli</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://scholar.google.com/citations?user=xGU7H1QAAAAJ&amp;hl=en">
    <span class="ai ai-google-scholar fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://orcid.org/0000-0002-0559-5176">
    <span class="ai ai-orcid fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/storopoli">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/JoseStoropoli">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/storopoli/">
    <span class="fa fa-linkedin fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Modelos Lineares Generalizados - Binomial</h1>

</div>


<p>Saindo do universo dos modelos lineares, começamos a nos aventurar nos modelos linares generalizados (<em>generalized linear models</em> - GLM). O primeiro deles é a regressão logística (também chamada de regressão binomial).</p>
<p>Uma regressão logística se comporta exatamente como um modelo linear: faz uma predição simplesmente computando uma soma ponderada das variáveis independentes, mais uma constante. Porém ao invés de retornar um valor contínuo, como a regressão linear, retorna a função logística desse valor.</p>
<p><span class="math display">\[\operatorname{Logística}(x) = \frac{1}{1 + e^{(-x)}}\]</span></p>
<p>Usamos regressão logística quando a nossa variável dependente é binária. Ela possui apenas dois valores distintos, geralmente codificados como <span class="math inline">\(0\)</span> ou <span class="math inline">\(1\)</span>.</p>
<pre class="r"><code>x &lt;- seq(-10, 10, length.out = 100)
sig &lt;- 1 / (1 + exp(-x))
plot(x, sig, type = &quot;l&quot;, lwd=2, ylab = &quot;Logística(x)&quot;)</code></pre>
<p><img src="6-Regressao_Binomial_files/figure-html/sigmoid_function-1.png" width="672" /></p>
<div id="comparativo-com-a-regressão-linear" class="section level2">
<h2>Comparativo com a Regressão Linear</h2>
<p><span class="math display">\[ \operatorname{Linear} = \theta_0 + \theta_1 x_1 + \theta_2 x_2 + \dots + \theta_n x_n\]</span></p>
<p><span class="math inline">\(\operatorname{Linear}\)</span> - regressão linear</p>
<p><span class="math inline">\(\theta\)</span> - parâmetro do modelo</p>
<p><span class="math inline">\(n\)</span> - número de atributos (<em>features</em>)</p>
<p><span class="math inline">\(x_i\)</span> - o valor do <em>inésimo</em> atributo (<em>feature</em>)</p>
<p><span class="math inline">\(\hat{p} = \sigma(\operatorname{Linear}) = \frac{1}{1 + e^{-\operatorname{Linear}}}\)</span></p>
<p><span class="math inline">\(\hat{p}\)</span> - probabilidade prevista da observação ser 1</p>
<p><span class="math inline">\(\hat{y}=\left\{\begin{array}{ll} 0 &amp; \text { se } \hat{p} &lt; 0.5 \\ 1 &amp; \text { se } \hat{p} \geq 0.5 \end{array}\right.\)</span></p>
<div id="exemplo" class="section level3">
<h3>Exemplo</h3>
<p><span class="math display">\[\mathrm{Previsão~de~Morte} = \sigma \big(-10 + 10\times \mathrm{cancer} + 12 \times \mathrm{diabetes} + 8 \times \mathrm{obesidade} \big)\]</span></p>
</div>
</div>
<div id="regressão-logística-com-o-rstanarm" class="section level2">
<h2>Regressão logística com o <code>rstanarm</code></h2>
<p>O <code>rstanarm</code> pode tolerar qualquer modelo linear generalizado e regressão logística não é uma exceção. Para rodar um modelo binomial no <code>rstanarm</code> é preciso simplesmente alterar o argumento <code>family</code> da função <code>stan_glm</code>.</p>
<p>Para exemplo, usaremos um <em>dataset</em> chamado <code>wells</code> do pacote <code>rstanarm</code>. É uma survey com 3200 residentes de uma pequena área de Bangladesh na qual os lençóis freáticos estão contaminados por arsênico. Respondentes com altos níveis de arsênico nos seus poços foram encorajados para trocar a sua fonte de água para uma níveis seguros de arsênico.</p>
<p>Possui as seguintes variáveis:</p>
<ul>
<li><code>switch</code>: dependente indicando se o respondente trocou ou não de poço</li>
<li><code>arsenic</code>: nível de arsênico do poço do respondente</li>
<li><code>dist</code>: distância em metros da casa do respondente até o poço seguro mais próximo</li>
<li><code>association</code>: <em>dummy</em> se os membros da casa do respondente fazem parte de alguma organização da comunidade</li>
<li><code>educ</code>: quantidade de anos de educação que o chefe da família respondente possui</li>
</ul>
<pre class="r"><code>options(mc.cores = parallel::detectCores())
options(Ncpus = parallel::detectCores())

library(rstanarm)
data(wells)

model_binomial &lt;- stan_glm(
  switch ~ dist + arsenic + assoc + educ,
  data = wells,
  family = binomial()
    )</code></pre>
<pre class="r"><code>summary(model_binomial)</code></pre>
<pre><code>## 
## Model Info:
##  function:     stan_glm
##  family:       binomial [logit]
##  formula:      switch ~ dist + arsenic + assoc + educ
##  algorithm:    sampling
##  sample:       4000 (posterior sample size)
##  priors:       see help(&#39;prior_summary&#39;)
##  observations: 3020
##  predictors:   5
## 
## Estimates:
##               mean   sd   10%   50%   90%
## (Intercept) -0.2    0.1 -0.3  -0.2   0.0 
## dist         0.0    0.0  0.0   0.0   0.0 
## arsenic      0.5    0.0  0.4   0.5   0.5 
## assoc       -0.1    0.1 -0.2  -0.1   0.0 
## educ         0.0    0.0  0.0   0.0   0.1 
## 
## Fit Diagnostics:
##            mean   sd   10%   50%   90%
## mean_PPD 0.6    0.0  0.6   0.6   0.6  
## 
## The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).
## 
## MCMC diagnostics
##               mcse Rhat n_eff
## (Intercept)   0.0  1.0  5935 
## dist          0.0  1.0  5233 
## arsenic       0.0  1.0  4517 
## assoc         0.0  1.0  5848 
## educ          0.0  1.0  5449 
## mean_PPD      0.0  1.0  4362 
## log-posterior 0.0  1.0  1614 
## 
## For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<div id="interpretação-dos-coeficientes" class="section level2">
<h2>Interpretação dos coeficientes</h2>
<p>Ao vermos a fórmula de regressão binomial vemos que para analisarmos o efeito de um preditor na variável dependente temos que calcular o valor logístico dos coeficientes do preditor. E interpretamos como chances (<em>odds ratio</em>) na qual 1 é neutro e qualquer valor abaixo de 1 tende a respostas codificadas como 0 e qualquer valor acima de 1 tende a respostas codificadas como 1.</p>
<p><span class="math display">\[\text{odds ratio} = e^{(x)}\]</span></p>
<pre class="r"><code>coeff &lt;- exp(model_binomial$coefficients)
coeff</code></pre>
<pre><code>## (Intercept)        dist     arsenic       assoc        educ 
##        0.85        0.99        1.60        0.88        1.04</code></pre>
<ul>
<li><code>(Intercept)</code>: a chance basal de respondentes mudarem de poço (15% de não mudarem)</li>
<li><code>dist</code>: a cada metro de distância <strong>diminui</strong> a chance de troca de poço em 1%</li>
<li><code>arsenic</code>: a cada incremento do nível de arsênico <strong>aumenta</strong> a chance de troca de poço em 60%</li>
<li><code>assoc</code>: residências com membros que fazem parte de alguma organização da comunidade <strong>diminui</strong> a chance de troca de poço em 12%</li>
<li><code>educ</code>: a cada incremento dos anos de estudo <strong>aumenta</strong> a chance de troca de poço em 4%</li>
</ul>
</div>
<div id="priors" class="section level2">
<h2>Priors</h2>
<p><code>rstanarm</code> possui as seguintes configurações como padrão de priors para regressão binomial:</p>
<ul>
<li>Constante (<em>Intercept</em>): centralizada com média <span class="math inline">\(\mu = 0\)</span> e desvio padrão de <span class="math inline">\(2.5 \sigma_y\)</span> - <code>prior_intercept = normal(0, 2.5 * sd_y)</code></li>
<li>Coeficientes: para cada coeficiente média <span class="math inline">\(\mu = 0\)</span> and standard deviation of <span class="math inline">\(2.5\times\frac{1}{\sigma_{x_k}}\)</span> - <code>prior = normal(0, 2.5 * 1/sd_xk)</code></li>
<li>Erro residual (<code>prior_aux</code>): uma distribuição exponencial com taxa <span class="math inline">\(\frac{1}{\sigma_y}\)</span>: <code>prior_aux = exponential(1/sd_y)</code></li>
</ul>
</div>
<div id="atividade-prática" class="section level2">
<h2>Atividade Prática</h2>
<p>Dois <em>datasets</em> estão disponíveis na pasta <code>datasets/</code>:</p>
<ol style="list-style-type: decimal">
<li><a href="http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/Ctitanic3.html">Titanic Survival</a>: <code>datasets/Titanic_Survival.csv</code></li>
<li><a href="https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset">IBM HR Analytics Employee Attrition &amp; Performance</a>: <code>datasets/IBM_HR_Attrition.csv</code></li>
</ol>
<pre class="r"><code>###</code></pre>
</div>
<div id="ambiente" class="section level2">
<h2>Ambiente</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] carData_3.0-4   gapminder_0.3.0 skimr_2.1.2     rstanarm_2.21.1 Rcpp_1.0.5      readxl_1.3.1   
## 
## loaded via a namespace (and not attached):
##   [1] nlme_3.1-150         matrixStats_0.57.0   xts_0.12.1           threejs_0.3.3        rstan_2.21.2         repr_1.1.0          
##   [7] tools_4.0.3          utf8_1.1.4           R6_2.5.0             DT_0.16              colorspace_2.0-0     withr_2.3.0         
##  [13] tidyselect_1.1.0     gridExtra_2.3        prettyunits_1.1.1    processx_3.4.5       curl_4.3             compiler_4.0.3      
##  [19] cli_2.2.0            shinyjs_2.0.0        labeling_0.4.2       colourpicker_1.1.0   scales_1.1.1         dygraphs_1.1.1.6    
##  [25] ggridges_0.5.2       callr_3.5.1          stringr_1.4.0        digest_0.6.27        StanHeaders_2.21.0-6 minqa_1.2.4         
##  [31] rmarkdown_2.5        base64enc_0.1-3      pkgconfig_2.0.3      htmltools_0.5.0      lme4_1.1-26          highr_0.8           
##  [37] fastmap_1.0.1        htmlwidgets_1.5.2    rlang_0.4.9          shiny_1.5.0          farver_2.0.3         generics_0.1.0      
##  [43] zoo_1.8-8            jsonlite_1.7.1       crosstalk_1.1.0.1    gtools_3.8.2         dplyr_1.0.2          inline_0.3.17       
##  [49] magrittr_2.0.1       loo_2.3.1            bayesplot_1.7.2      Matrix_1.2-18        munsell_0.5.0        fansi_0.4.1         
##  [55] lifecycle_0.2.0      stringi_1.5.3        yaml_2.2.1           MASS_7.3-53          pkgbuild_1.1.0       plyr_1.8.6          
##  [61] grid_4.0.3           parallel_4.0.3       promises_1.1.1       crayon_1.3.4         miniUI_0.1.1.1       lattice_0.20-41     
##  [67] splines_4.0.3        knitr_1.30           ps_1.4.0             pillar_1.4.7         igraph_1.2.6         boot_1.3-25         
##  [73] markdown_1.1         shinystan_2.5.0      reshape2_1.4.4       codetools_0.2-18     stats4_4.0.3         rstantools_2.1.1    
##  [79] glue_1.4.2           evaluate_0.14        V8_3.4.0             RcppParallel_5.0.2   nloptr_1.2.2.2       vctrs_0.3.5         
##  [85] httpuv_1.5.4         cellranger_1.1.0     tidyr_1.1.2          gtable_0.3.0         purrr_0.3.4          assertthat_0.2.1    
##  [91] ggplot2_3.3.2        xfun_0.19            mime_0.9             xtable_1.8-4         later_1.1.0.1        survival_3.2-7      
##  [97] rsconnect_0.8.16     tibble_3.0.4         shinythemes_1.1.2    statmod_1.4.35       ellipsis_0.3.1</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
